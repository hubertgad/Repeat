@page
@model Repeat.Pages.Administration.Questions.DetailsModel
@inject UserManager<IdentityUser> UserManager


@{
    ViewData["Title"] = "Details";
    Layout = "~/Pages/Administration/_Layout.cshtml";
}

<br />
<div>
    <h4>Question details</h4>
    <hr />
    <dl class="row center">
        <dt class="col-sm-2">
            <label>Category:</label>
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Question.Category.Name)
        </dd>
        <dt class="col-sm-2">
            <label>Question:</label>
        </dt>
        <dd class="col-sm-10">
            @foreach (var part in Model.SplitTextByPattern(Model.Question.QuestionText))
            {
                if (part.Contains(@"<code>") && (part.Contains(@"</code>")))
                {
                    <span class="code">
                    @foreach (var line in part.Replace("<code>", "").Replace("</code>", "").Split("\n"))
                    {
                        <code class="multiline">@Html.DisplayFor(x => line)<br /></code>
                    }
                    </span>
                }
                else
                {
                    <span class="multiline">@Html.DisplayFor(x => part)</span>
                }
            }
        </dd>
        @if (Model.Question.Picture != null)
        {
            <dt class="col-sm-2">
                <label>Picture:</label>
            </dt>
            <dd class="col-sm-10">
                <img src="@FileUpload.ToString(Model.Question.Picture.Data)" />
            </dd>
        }
        @for (int i = 0; i < Model.Question.Answers.Count(); i++)
        {
            <dt class="col-sm-2">
                <nobr>
                    <label>
                        Answer @((char)('A' + i)):
                        @if (Model.Question.Answers[i].IsTrue)
                        {
                            <label class="badge badge-success">True</label>
                        }
                        else
                        {
                            <label class="badge badge-danger">False</label>

                        }
                    </label>
                </nobr>
            </dt>
            <dd class="col-sm-10">
                @foreach (var part in Model.SplitTextByPattern(Model.Question.Answers[i].AnswerText))
                {
                    if (part.Contains(@"<code>") && (part.Contains(@"</code>")))
                    {
                        <span class="code">
                            @foreach (var line in part.Replace("<code>", "").Replace("</code>", "").Split("\n"))
                            {
                                <code class="multiline">@Html.DisplayFor(x => line)<br /></code>

                            }
                        </span>
                    }
                    else
                    {
                        <span class="multiline">@Html.DisplayFor(x => part)</span>
                    }
                }
            </dd>
        }
        @if (Model.Question.Reference != null)
        {
            <dt class="col-sm-2">
                <label>References:</label>
            </dt>
            <dd class="col-sm-10">
                <a class="multiline">@Html.DisplayFor(model => model.Question.Reference)</a>
            </dd>
        }
        <dt class="col-sm-2">
            <label>Owner:</label>
        </dt>
        <dd class="col-sm-10">
            <label>@UserManager.FindByIdAsync(Model.Question.OwnerID).Result.UserName</label>
        </dd>
        <dt class="col-sm-2">
            <label>Sets:</label>
        </dt>
        <dd class="col-sm-10">
            @foreach (var set in Model.Question.QuestionSets.Select(q => q.Set).ToList())
            {
                <label class="badge-pill badge-secondary">@set.Name</label>
            }
        </dd>
    </dl>
</div>
<div>
    @{ if (Model.Question.OwnerID == Model.CurrentUserID)
        {
            <a asp-page="./Edit" asp-route-id="@Model.Question.ID"
               class="btn btn-warning">Edit</a> <a>|</a>
        }
    }
    <a asp-page="Index" class="btn btn-dark">Back to List</a>
</div>